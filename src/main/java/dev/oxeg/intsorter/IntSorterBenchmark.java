package dev.oxeg.intsorter;

import dev.oxeg.intsorter.java.ArraySortImplementation;
import dev.oxeg.intsorter.oxeg.BubbleImplementation;
import org.openjdk.jmh.annotations.*;
import org.openjdk.jmh.infra.Blackhole;
import org.openjdk.jmh.runner.Runner;
import org.openjdk.jmh.runner.RunnerException;
import org.openjdk.jmh.runner.options.Options;
import org.openjdk.jmh.runner.options.OptionsBuilder;

import java.util.Arrays;
import java.util.concurrent.TimeUnit;

@BenchmarkMode(Mode.AverageTime)
@OutputTimeUnit(TimeUnit.NANOSECONDS)
@Warmup(iterations = 5, time = 1)
@Measurement(iterations = 5, time = 1)
@Fork(1)
@State(Scope.Thread)
public class IntSorterBenchmark {
    int[] sampleArray;

    @Setup
    public void prepareSampleArray() {
        sampleArray = Arrays.copyOf(SAMPLE_ARRAY, SAMPLE_ARRAY.length);
    }

    IntSorter arraySortImplementation = new ArraySortImplementation();
    IntSorter oxegBubbleImplementation = new BubbleImplementation();

    @Benchmark
    public void javaArraySortImplementation(Blackhole bh) {
        bh.consume(arraySortImplementation.sort(sampleArray));
    }

    @Benchmark
    public void oxegBubbleImplementation(Blackhole bh) {
        bh.consume(oxegBubbleImplementation.sort(sampleArray));
    }

    public static void main(String[] args) throws RunnerException {
        Options opt = new OptionsBuilder()
                .include(IntSorterBenchmark.class.getSimpleName())
                .build();

        new Runner(opt).run();
    }

    static final int[] SAMPLE_ARRAY = new int[]{
            402, 687, 551, 892, 571, 249, 622, 314, 481, 607, 721, 33, 604, 289, 113, 668, 397, 695, 191, 311,
            871, 780, 914, 489, 160, 876, 479, 221, 70, 83, 311, 158, 394, 638, 618, 29, 816, 651, 938, 395,
            479, 816, 372, 647, 307, 489, 784, 155, 734, 263, 772, 704, 545, 905, 764, 597, 660, 733, 422, 690,
            304, 308, 587, 726, 131, 361, 232, 301, 735, 934, 873, 765, 668, 444, 272, 291, 258, 169, 122, 343,
            138, 328, 575, 79, 309, 302, 508, 692, 767, 661, 393, 617, 612, 719, 869, 798, 633, 148, 882, 842,
            730, 719, 159, 308, 807, 690, 809, 381, 172, 328, 184, 206, 259, 312, 649, 533, 290, 240, 122, 463,
            502, 175, 549, 667, 546, 842, 139, 680, 104, 208, 208, 417, 450, 70, 114, 310, 234, 421, 861, 229,
            609, 934, 490, 985, 603, 886, 571, 435, 273, 795, 817, 80, 918, 889, 545, 832, 838, 604, 950, 283,
            760, 469, 58, 106, 398, 602, 131, 522, 53, 615, 883, 553, 403, 971, 575, 360, 259, 145, 334, 676,
            727, 923, 200, 195, 164, 438, 539, 910, 996, 960, 893, 299, 438, 824, 430, 203, 768, 136, 743, 360,
            305, 877, 597, 92, 512, 668, 358, 457, 396, 221, 473, 286, 820, 561, 457, 247, 651, 143, 5, 926,
            365, 549, 921, 150, 489, 95, 283, 638, 977, 98, 890, 15, 277, 201, 63, 680, 41, 890, 932, 69,
            684, 702, 895, 239, 928, 781, 267, 862, 169, 354, 642, 647, 786, 288, 141, 391, 420, 598, 925, 700,
            724, 723, 470, 955, 669, 934, 519, 484, 532, 416, 593, 730, 848, 97, 338, 499, 692, 434, 241, 185,
            744, 648, 749, 923, 301, 269, 273, 326, 546, 943, 488, 934, 918, 753, 956, 532, 545, 684, 205, 401,
            909, 720, 534, 16, 58, 153, 156, 290, 851, 20, 581, 662, 484, 111, 354, 709, 345, 155, 955, 505,
            857, 634, 45, 768, 576, 80, 641, 458, 497, 367, 110, 36, 646, 1000, 109, 767, 866, 438, 544, 515,
            849, 196, 455, 534, 734, 695, 335, 164, 573, 75, 782, 519, 501, 668, 49, 395, 744, 697, 301, 794,
            602, 622, 209, 448, 113, 166, 630, 468, 355, 110, 83, 83, 159, 13, 726, 347, 246, 495, 694, 312,
            50, 543, 943, 199, 812, 895, 911, 216, 817, 956, 579, 506, 700, 96, 212, 929, 717, 101, 20, 692,
            687, 645, 656, 2, 896, 882, 75, 39, 420, 168, 666, 756, 754, 849, 881, 414, 719, 704, 93, 341,
            497, 915, 493, 713, 836, 309, 822, 921, 529, 813, 753, 65, 504, 786, 173, 251, 376, 554, 740, 724,
            364, 411, 598, 269, 492, 463, 240, 717, 66, 9, 908, 665, 792, 85, 628, 604, 296, 266, 822, 39,
            631, 332, 924, 306, 689, 306, 528, 94, 941, 577, 123, 327, 874, 649, 269, 49, 56, 235, 251, 436,
            694, 669, 426, 212, 378, 838, 196, 964, 999, 715, 927, 371, 772, 542, 446, 412, 188, 185, 941, 734,
            200, 923, 196, 742, 606, 148, 248, 752, 347, 242, 447, 547, 44, 429, 143, 268, 695, 532, 672, 32,
            157, 808, 141, 358, 745, 542, 279, 936, 649, 542, 762, 359, 406, 785, 86, 165, 197, 943, 253, 196,
            938, 359, 413, 907, 320, 757, 546, 894, 93, 291, 743, 224, 762, 166, 468, 417, 527, 429, 215, 421,
            707, 224, 756, 465, 843, 757, 768, 720, 906, 437, 611, 1, 910, 447, 292, 815, 336, 751, 159, 883,
            959, 810, 253, 832, 203, 300, 47, 784, 176, 340, 893, 443, 817, 972, 115, 264, 48, 956, 474, 319,
            381, 99, 370, 701, 310, 336, 419, 241, 456, 953, 324, 929, 996, 900, 809, 960, 172, 21, 670, 172,
            535, 196, 875, 915, 293, 897, 358, 927, 486, 311, 349, 187, 898, 72, 237, 631, 901, 687, 511, 633,
            264, 98, 681, 635, 309, 726, 412, 863, 509, 974, 923, 383, 349, 482, 694, 112, 144, 288, 999, 589,
            69, 425, 212, 927, 151, 486, 1, 283, 66, 406, 657, 952, 411, 589, 485, 803, 372, 77, 498, 996,
            740, 583, 420, 585, 312, 274, 988, 333, 732, 763, 466, 717, 279, 536, 458, 868, 115, 320, 320, 86,
            8, 30, 634, 403, 784, 90, 325, 442, 748, 519, 287, 116, 849, 309, 677, 247, 864, 670, 564, 975,
            111, 857, 996, 539, 602, 267, 749, 560, 686, 919, 219, 180, 924, 664, 888, 622, 109, 203, 816, 777,
            118, 316, 731, 233, 733, 767, 865, 785, 861, 974, 11, 986, 920, 511, 379, 162, 307, 890, 436, 645,
            943, 873, 793, 657, 235, 476, 37, 386, 200, 151, 988, 209, 858, 374, 360, 187, 635, 781, 123, 78,
            57, 308, 359, 979, 182, 96, 17, 350, 626, 86, 106, 929, 426, 379, 200, 384, 125, 59, 728, 868,
            781, 962, 699, 288, 204, 258, 772, 968, 26, 87, 883, 258, 898, 623, 933, 728, 507, 486, 198, 734,
            598, 748, 253, 517, 957, 678, 183, 356, 990, 2, 52, 736, 496, 335, 934, 240, 138, 856, 68, 259,
            10, 353, 819, 61, 727, 650, 337, 523, 592, 17, 732, 403, 251, 917, 553, 452, 527, 995, 73, 116,
            359, 609, 789, 662, 908, 694, 873, 67, 943, 952, 662, 153, 592, 484, 833, 760, 601, 364, 270, 193,
            653, 713, 755, 735, 298, 524, 467, 221, 987, 241, 622, 42, 297, 26, 174, 611, 283, 822, 912, 415,
            844, 578, 419, 821, 320, 487, 618, 536, 866, 783, 515, 539, 129, 329, 208, 546, 422, 310, 115, 238,
            187, 202, 38, 479, 770, 693, 113, 462, 347, 599, 948, 478, 694, 869, 295, 229, 837, 586, 479, 780,
            70, 256, 189, 231, 985, 129, 764, 127, 72, 638, 86, 161, 307, 487, 489, 958, 377, 388, 335, 222,
            648, 799, 300, 909, 879, 507, 58, 325, 633, 896, 522, 396, 742, 60, 311, 723, 900, 51, 406, 129,
            418, 345, 980, 655, 351, 741, 412, 986, 661, 465, 956, 399, 929, 621, 116, 505, 342, 441, 662, 972,
    };
}
